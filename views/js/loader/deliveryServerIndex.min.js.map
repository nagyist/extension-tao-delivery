{"version":3,"mappings":"AAsBA,YACA,aADA,GAKAA,mDALA,CAMAC,kDANA,CAOAC,+CAPA,CASAC,4CACAC,qBADA,CAEAC,2DAFA,CAGAC,+CAHA,CAIA,IACAF,oCACA,YACAA,oBACA,CACAG,qDACA,+CACAA,cADA,GAEAA,iBAFA,CAGAC,mCAHA,CAKA,CALA,CAMAC,gEAPA,CAQA,gCARA,EASAC,iBAEA,CAXA,CAYA,CA9BA,CAiCAH,sCAGAA,kBAHA,GAMAA,gBANA,CAaAA,iDACAI,mBADA,CAEAA,sCAFA,CAGAA,4CACA,oEACA,CAFA,CAHA,CAMAC,2BACAD,+BACAJ,sBACA,CAFA,CADA,CAIAJ,gBACA,CALA,CAMA,CAzBA,EA4BAD,6CA5BA,CA6BAK,4BA7BA,CA+BAJ,gBAEA,CAjCA,CAkCA,CAnEA,G,CAqEAU,uC,CCnEAA,sDACA,QADA,CAEA,QAFA,CAGA,MAHA,CAIA,QAJA,CAKA,aALA,CAMA,aANA,CAOA,aAPA,CAQA,oBARA,CASA,SATA,CAUA,aAVA,CAWA,cAXA,EAYA,gFACA,aADA,GAGAC,uCAHA,CAKAC,mCALA,CAYAC,wEACAC,cADA,EAEAC,mDACAC,UADA,CAEAC,QAFA,EAKA,CAnBA,CAyBAC,uDACA,sEAEA,wEAIA,MAHAC,4BAGA,GAFAhB,6CAEA,QACA,CALA,CAKA,EALA,CAMA,CAlCA,CAuCA,OAOAiB,KAPA,gBAOAC,UAPA,CAOA,IACAC,mBADA,CAOAC,sCACAC,gCADA,GAEAF,kBAFA,CAGAG,kBAHA,CAIArB,wBAJA,CAMA,CAbA,CAkBAsB,iCAEAC,4EACA,CArBA,CAuBAC,sBAvBA,CA0BAP,+BA1BA,EA2BAG,gDACAX,sDACA,CAFA,CA3BA,CAiCA,gJAEAgB,WAnCA,EAoCAhB,wFApCA,CAqCA,CACAiB,WAtCA,EAuCAnB,yBAvCA,CAwCA,CAEA,8CACA,4BAEAoB,kBAHA,CAIAA,mBAJA,CAMAT,0CANA,EAOAC,mCAEA,CATA,CAWAG,YArDA,CAsDAC,4CAtDA,CAuDAA,yCACAf,6CADA,EAEAoB,iBAEA,CAJA,CAvDA,CA8DAJ,gEA9DA,EA+DAK,mCAEA,CAxEA,CA0EA,CA7HA,C,CCvBAvB,oE","names":["loaderScript","configUrl","bundle","loadController","controllerOptions","controllerPath","params","window","controller","document","startController","bundles","require","define","logger","accessibilityLaunchKeyCodes","displayPermanentMessage","level","feedback","timeout","popup","getLTIErrorParameters","searchParams","start","parameters","deliveryStarted","runDelivery","_","loadingBar","supportRTL","$","config","ltiErrorMsg","ltiErrorLog","e","launchDelivery","router"],"sources":["../../loader/bootstrap.js","../controller/DeliveryServer/index.js","module-create.js"],"sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016-2018 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * Bootstrap the app, start the entry controller\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\n(function(){\n    'use strict';\n\n\n\n    var loaderScript = document.getElementById('amd-loader');\n    var configUrl = loaderScript.getAttribute('data-config');\n    var bundle  = loaderScript.getAttribute('data-bundle');\n\n    var loadController = function loadController(){\n        var controllerOptions = {};\n        var controllerPath = loaderScript.getAttribute('data-controller');\n        var params = loaderScript.getAttribute('data-params');\n        try{\n            controllerOptions = JSON.parse(params);\n        } catch(err){\n            controllerOptions = {};\n        }\n        window.require([controllerPath], function(controller) {\n            var startController = function startController(){\n                if(!window.started){\n                    window.started = true;\n                    controller.start(controllerOptions);\n                }\n            };\n            document.addEventListener('readystatechange', startController, false);\n            if (document.readyState === 'complete') {\n                startController();\n            }\n        });\n    };\n\n    //always start to load the config\n    window.require([configUrl], function() {\n\n        //define the global loading mechanism\n        if(!window.loadBundles){\n            //keep tracl of loaded bundles, even if require does it,\n            //this prevent some unecessary cycles\n            window.loaded = {};\n\n            /**\n             * Loading entry point for inter bundle dependency,\n             * always take the bundles from the params and window.bundles\n             * @param {String[]} [bundles] - an optional list of bundle to load\n             */\n            window.loadBundles = function loadBundles(bundles){\n                bundles = bundles || [];\n                bundles = bundles.concat(window.bundles)\n                bundles = bundles.filter( function(item, index){\n                    return item && bundles.indexOf(item) === index && window.loaded[item] !== true;\n                });\n                require(bundles, function(){\n                    bundles.forEach( function( item ) {\n                        window.loaded[item] = true;\n                    });\n                    loadController();\n                });\n            }\n        }\n\n        if(bundle || (window.bundles && window.bundles.length)) {\n            window.loadBundles([bundle]);\n        } else {\n            loadController();\n        }\n    });\n})();\n\ndefine(\"loader/bootstrap\", function(){});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016-2019 (original work) Open Assessment Technologies SA ;\n *\n */\n\n/**\n * The DeliveryServer/index controller.\n *\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoDelivery/controller/DeliveryServer/index',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'module',\n    'core/router',\n    'ui/feedback',\n    'core/logger',\n    'layout/loading-bar',\n    'context',\n    'util/locale',\n    'url-polyfill'\n], function($, _, __, module, router, feedback, loggerFactory, loadingBar, context, locale){\n    'use strict';\n\n    const logger = loggerFactory('deliveryServer');\n\n    const accessibilityLaunchKeyCodes = [13, 32];  // \"enter\" or \"space\" - list of keys able to run delivery\n\n    /**\n     * Display a permanent message\n     * @param {String} level - in supported feedbacks' levels\n     * @param {String} content - the message to display\n     */\n    const displayPermanentMessage = (level, content) => {\n        if(level && content){\n            feedback($('.permanent-feedback'))[level](content, {\n                timeout : -1,\n                popup : false\n            });\n        }\n    };\n\n    /**\n     * Extract standard LTI error parameters from query string\n     * @returns {Object} LTI error parameters\n     */\n    const getLTIErrorParameters = () => {\n        const { searchParams } = new URL(window.location.href);\n\n        return ['lti_errormsg', 'lti_errorlog'].reduce((params, paramName) => {\n            if (searchParams.has(paramName)) {\n                params[paramName] = searchParams.get(paramName);\n            }\n            return params;\n        }, {});\n    };\n\n    /**\n     * The DeliveryServer/index controller\n     */\n    return {\n\n        /**\n         * Controller entry point\n         * @param {Object} [parameters] - controller's data\n         * @param {Object} [parameters.messages] - message data to display\n         */\n        start(parameters){\n            let deliveryStarted = false;\n\n            /**\n             * Run/open the given delivery\n             * @param {String} url - the delivery URL\n             */\n            const runDelivery = function runDelivery (url) {\n                if(_.isString(url) && !_.isEmpty(url)){\n                    deliveryStarted = true;\n                    loadingBar.start();\n                    window.location.href = url;\n                }\n            };\n\n            /**\n             * improve UI to support rtl languages\n             */\n            const supportRTL = function supportRTL () {\n                // adding attr for RTL languages\n                $('.delivery-scope').attr({dir: locale.getLanguageDirection(context.locale)});\n            };\n\n            const config = module.config();\n\n            // display as feedbacks any messages in parameters\n            if (parameters && parameters.messages) {\n                _.forEach(parameters.messages, message => {\n                    displayPermanentMessage(message.level, message.content);\n                });\n            }\n\n            // display as feedbacks any LTI error messages from query string\n            const { lti_errormsg: ltiErrorMsg, lti_errorlog: ltiErrorLog } = getLTIErrorParameters();\n\n            if (ltiErrorMsg) {\n                displayPermanentMessage('error', ltiErrorMsg.length ? ltiErrorMsg : __('An error occurred!'));\n            };\n            if (ltiErrorLog) {\n                logger.error(ltiErrorLog);\n            };\n\n            const launchDelivery = function (e) {\n                const $elt = $(e.currentTarget);\n\n                e.preventDefault();\n                e.stopPropagation();\n\n                if(!deliveryStarted && !$elt.hasClass('disabled')){\n                    runDelivery($elt.data().launch_url);\n                }\n            };\n\n            supportRTL();\n            $('.entry-point').on('click', launchDelivery);\n            $('.entry-point').on('keyup', (e) => {\n                if(accessibilityLaunchKeyCodes.includes(e.which)) {\n                    launchDelivery(e);\n                }\n            });\n\n            // dispatch any extra registered routes\n            if (config && _.isArray(config.extraRoutes) && config.extraRoutes.length) {\n                router.dispatch(config.extraRoutes);\n            }\n        }\n    };\n});\n\n","\ndefine(\"taoDelivery/loader/deliveryServerIndex.bundle\", function(){});\n"]}