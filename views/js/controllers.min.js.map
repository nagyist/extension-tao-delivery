{"version":3,"file":"taoDelivery/controller/routes.js","sources":["routes.js","delivery/editDelivery.js","delivery/testtaker.js","../../serviceApi/ServiceApi.js","../../serviceApi/StateStorage.js","../../serviceApi/UserInfoService.js","tpl!taoDelivery/tpl/fullscreen-modal-feedback","runtime/fullScreen.js","runtime/deliveryExecution.js"],"names":["define","Delivery","actions","editDelivery","excludeTesttaker","$","helpers","start","click","delivery","this","data","load","_url","uri","prepend","modal","__","module","section","feedback","switchList","target","current","parent","attr","append","scrollIntoView","timeout","$search","$list","liveSearch","pattern","val","clearTimeout","setTimeout","filterList","RegExp","regex","list","children","each","index","element","text","match","hide","show","excluded","push","assemblyUri","ajax","url","type","JSON","stringify","dataType","success","response","saved","loadContentBlock","keyup","siblings","UrlParser","iframeResizer","ServiceApi","baseUrl","parameters","serviceCallId","stateStorage","userService","connected","state","onFinishCallback","onKillCallback","onDisplayChangeCallback","SIG_SUCCESS","SIG_ERROR","prototype","loadInto","frame","self","$frame","callUrl","getCallUrl","isCORSAllowed","checkCORS","on","e","document","connect","off","contentWindow","__knownParent__","onServiceApiReady","params","param","getUserPropertyValues","property","callback","get","getServiceCallId","getState","setState","set","getParameter","identifier","onFinish","onKill","kill","finish","valueArray","StateStorage","submitUrl","UserInfoService","requestUrl","hasOwnProperty","service","r","key","hb","template","Handlebars","depth0","partials","program1","stack1","helper","buffer","launchButton","call","hash","functionType","escapeExpression","program3","options","helperMissing","program5","compilerInfo","merge","unless","fsSupported","inverse","noop","fn","program","dialogTpl","$dialog","$body","d","dElem","documentElement","fs","_fs","isSupported","exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","Element","ALLOW_KEYBOARD_INPUT","fullscreenchange","prefixes","i","length","fullScreen","fullscreenElement","mozFullScreen","webkitIsFullScreen","screen","availHeight","height","window","innerHeight","changeInterval","awaitFsChange","event","createEvent","initEvent","setInterval","dispatchEvent","handleUserInput","evt","keyCode","which","className","init","body","addEventListener","replace","navigator","platform","toLowerCase","indexOf","querySelector","clearInterval","width","disableClosing","startClosed","context","loadingBar","resizeMainFrame","outerHeight","$headerHeight","$footerHeight","$frameContainer","serviceApi","config","deliveryServerConfig","requireFullScreen","find","location","root_url","eval","finishDeliveryExecution","deliveryExecution","destination","stop","bind"],"mappings":"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AAA1M,EAAA,iCAAAyM,eAAA,EACAE,cAAA3M,EAAA,iBAAAyM,eAAA,EAEAzM,EAAAoF,UAAAF,GAAA,mBAAA,WACAyF,OAAAuC,SAAAZ,QAAAa,SAAA,oBAGAN,WAAAO,KAAAN,OAAAD,YAEAA,WAAAvG,SAAA,WACAtG,EAAA8C,MACAC,IAAA+J,OAAAO,wBACA/M,MACAgN,kBAAAR,OAAAQ;ARlDA,EQoDAtK,KAAA,OACAG,SAAA,OACAC,QAAA,SAAA9C,MACAqK,OAAAuC,SAAA5M,KAAAiN,iBAKAvN,EAAAoF,UACAF,GAAA,UAAA,SAAAC,GACAoH,WAAArM,UAEAgF,GAAA,YAAA,WACApD,WAAA,WACAyK,WAAAiB,QACA,OAEAtI,GAAA,eAAA,WAEAlF,EAAAoF,UAAAE,IAAA,gBACAT,OAAAS,IAAA,oBACAA,IAAA,eAGAuH,WAAAnI,SAAAG,OAAAkB,IAAA,IAEA/F,EAAA2K,QAAA8C,KAAA,SAAA,WACAjB,oBAGAA;ARjFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjCA,ADkCA;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClGA,ADmGA;AClGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,AC5HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,ACjDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChDA,ADiDA;AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClLA,ADmLA;AClLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n * \n * \n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoDelivery/controller/routes',[],function(){\n    'use strict';\n\n    return {\n        'Delivery': {\n            'actions' : {\n            \t'editDelivery'     : 'controller/delivery/editDelivery',\n\t            'excludeTesttaker' : 'controller/delivery/testtaker'\n            }\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoDelivery/controller/delivery/editDelivery',['jquery', 'helpers', 'ui/modal'],\nfunction ($, helpers) {\n\t'use strict';\n\t\n\treturn {\n        start : function(){\n            $('#exclude-btn').click(function() {\n            \tvar delivery = $(this).data('delivery');\n        \t    $('#testtaker-form').load(helpers._url('excludeTesttaker', 'Delivery', 'taoDelivery', {'uri' : delivery}), function() {\n                    $('body').prepend($('#modal-container'));\n                    $('#testtaker-form').modal();\n                });\n        \t});\n        }\n\t}\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoDelivery/controller/delivery/testtaker',['jquery', 'i18n', 'helpers', 'module', 'layout/section', 'ui/feedback'], \nfunction ($, __, helpers, module, section, feedback) {\n    'use strict';\n\n\tfunction switchList() {\n\t\tvar current = $(this).parent().attr('id');\n        var target; \n\t\tif (current == 'excludedList') {\n\t\t\ttarget = $('#assignedList'); \n\t\t} else if (current == 'assignedList') {\n\t\t\ttarget = $('#excludedList');\n\t\t}\n\t\tif (typeof target !== 'undefined') {\n\t\t\ttarget.append(this);\n\t\t\tthis.scrollIntoView();\n\t\t}\n\t}\n\t\n\tvar $search = $('#tt-filter');\n    var $list   = $('#assignedList');\n    var timeout;\n    \n    var liveSearch = function(){\n        var pattern = $search.val();\n        clearTimeout(timeout);\n        timeout = setTimeout(function(){\n        \tfilterList(new RegExp(pattern), $list);\n        }, 300);\n    };\n    \n    var filterList = function(regex, list) {\n    \tlist.children().each(function(index, element) {\n    \t\tif ($(element).text().match(regex) === null) {\n    \t\t\t$(element).hide();\n    \t\t} else {\n    \t\t\t$(element).show();\n    \t\t}\n    \t});\n    };\n\t\n    return {\n        start : function(){\n\t        $('#save-tt').click(function() {\n\t        \tvar excluded = [];\n\t        \t$('#excludedList > li').each(function(index) {\n\t        \t\texcluded.push($(this).data('uri'));\n\t        \t});\n\t        \tvar assemblyUri = $('input[name=\"assemblyUri\"]').val();\n\t        \t$.ajax({\n\t        \t\turl: helpers._url('saveExcluded', 'Delivery', 'taoDelivery'),\n\t\t\t\t\ttype: \"POST\",\n\t\t\t\t\tdata: {\n\t\t\t\t\t\turi: assemblyUri,\n\t\t\t\t\t\texcluded: JSON.stringify(excluded)\n\t\t\t\t\t},\n\t\t\t\t\tdataType: 'json',\n\t\t\t\t\tsuccess: function(response) {\n\t\t\t\t\t\tif (response.saved) {\n                            feedback().success(__('Selection saved successfully'));\n                            section.loadContentBlock(helpers._url('editDelivery', 'Delivery', 'taoDelivery'), {uri: assemblyUri});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t        });\n        \t$('#assignedList > li').click(switchList);\n        \t$('#excludedList > li').click(switchList);\n        \t\n        \t$('#close-tt').click(function() {\n        \t\t$('#testtaker-form').modal('close');\n        \t});\n                \n            //trigger the search on keyp and on the magnifer button click\n            $search.keyup(liveSearch).siblings('.ctrl').click(liveSearch);\n        \t\n        }\n    };\n});\n\n\n\n","define('serviceApi/ServiceApi',['jquery', 'urlParser', 'iframeResizer'], function($, UrlParser, iframeResizer){\n    \n    function ServiceApi(baseUrl, parameters, serviceCallId, stateStorage, userService){\n        this.baseUrl = baseUrl;\n        this.parameters = parameters;\n        this.connected = false;\n\n        this.serviceCallId = serviceCallId; \n        this.state = stateStorage;\n        this.userService = userService;\n\n        this.onFinishCallback;\n        this.onKillCallback;\n        this.onDisplayChangeCallback;\n    }\n\n    ServiceApi.SIG_SUCCESS = 0; \n    ServiceApi.SIG_ERROR = 1;\n        \n    ServiceApi.prototype.loadInto = function(frame, connected){\n        var self = this;\n        var $frame = $(frame);\n        var callUrl = this.getCallUrl();        \n        var isCORSAllowed = new UrlParser(callUrl).checkCORS();\n\n        $frame.on('load', function(e){\n             //if we are  in the same domain, we add a variable\n             //to the frame window, so the frame knows it can communicate\n             //with the parent\n            $(document).on('serviceready', function(){\n                self.connect(frame, function(){\n                    $(document).off('serviceready');\n                    if(typeof connected === 'function'){\n                        connected();\n                    }\n                });\n            });\n             if(isCORSAllowed === true){\n                 frame.contentWindow.__knownParent__ = true;\n             }\n         });\n\n        $frame.attr('src', callUrl);\n    };\n\n    ServiceApi.prototype.connect = function(frame, connected){\n        if(this.connected === false && frame.contentWindow){\n            //frame.contentWindow.serviceApi = this;\n            if (typeof(frame.contentWindow.onServiceApiReady) === \"function\") {\n                frame.contentWindow.onServiceApiReady(this);\n                this.connected = true;\n                if(typeof connected === 'function'){\n                    connected();\n                }\n            }\n        }\n    };\n    \n    /**\n     * Get the service call URL\n     * @returns {String} the URI\n     */\n    ServiceApi.prototype.getCallUrl = function(){\n        var params = this.parameters || {};\n        params.serviceCallId = this.serviceCallId;\n        return this.baseUrl + '?' + $.param(params);\n    };\n\n    ServiceApi.prototype.getUserPropertyValues = function(property, callback){\n    \tthis.userService.get(property, callback);\n    };\n    \n    //Context\n    ServiceApi.prototype.getServiceCallId = function(){\n        return this.serviceCallId;\n    };\n\n    //Context\n    ServiceApi.prototype.getState = function(){\n        return this.state.get();\n    };\n\n    ServiceApi.prototype.setState = function(state, callback){\n        return this.state.set(state, callback);\n    };\n\n    // Variables \n    ServiceApi.prototype.getParameter = function(identifier){\n        if (typeof(this.parameters[identifier]) !== \"undefined\") {\n            return this.parameters[identifier];\n        } else {\n            return null;\n        }\n    };\n\n    ServiceApi.prototype.onFinish = function(callback) {\n        this.onFinishCallback = callback;\t\n    };\n\n    ServiceApi.prototype.onKill = function(callback) {\n        this.onKillCallback = callback;\t\n    };\n    \n    ServiceApi.prototype.kill = function(callback) {\n    \tif (typeof this.onKillCallback == 'function') {\n    \t\tthis.onKillCallback(callback);\n    \t} else {\n    \t\tcallback(0);\n    \t}\n    };\n    \n    // Flow\n    // valueArray are return parameters of the service.\n    ServiceApi.prototype.finish = function(valueArray) {\n            //return execution to service caller\n            if (typeof this.onFinishCallback === 'function') {\n                    this.onFinishCallback(valueArray);\n            }\n    };\n\n    return ServiceApi;\n\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA ;\n */\ndefine('serviceApi/StateStorage',['jquery'], function($){\n    'use strict';\n    \n    function StateStorage(state, submitUrl) {\n        this.state = state;\n        this.submitUrl = submitUrl;\n    }\n\n    StateStorage.prototype.get = function(callback){\n        if (typeof callback === 'function') {\n                callback(this.state);\n        }\n        return this.state;\n    };\n\n    StateStorage.prototype.set = function(state, callback){\n\n        if (state === this.state) {\n            if (typeof callback === \"function\") {\n                    callback();\n            }\n        } else {\n            this.state = state;\n            $.ajax({\n                url : this.submitUrl,\n                data \t\t: {\n                    'state' : state\n                },\n                type        : 'post',\n                dataType\t: 'json',\n                success     : typeof callback === \"function\" ? callback : null\n            });\n        }\n    };\n\n    return StateStorage;\n});\n","define('serviceApi/UserInfoService',['jquery'], function($){\n    \n    function UserInfoService(requestUrl, data) {\n        this.data = data;\n        this.requestUrl = requestUrl;\n    }\n\n    UserInfoService.prototype.get = function(property, callback){\n        if (this.data.hasOwnProperty(property)) {\n            if (typeof callback === \"function\") {\n                    callback(this.data[property]);\n            }\n        } else {\n            $.ajax({\n                url : this.requestUrl,\n                data \t\t: {\n                    'property' : property\n                },\n                type        : 'post',\n                dataType\t: 'json',\n                success     : (function(service, callback) {return function(r) {\n            \t\tfor (key in r.data) {\n            \t\t\tservice.data[key] = r.data[key];\n            \t\t}\n                    if (typeof callback === \"function\") {\n                        callback(service.data[property]);\n                    }\n\n                }})(this, callback)\n                /*\t\n            \tfunction(r){\n                    if(r.success){\n                    \tconsole.log(this.data);\n                    \tthis.data[property] = r.values;\n                    \t//console.log(this.data);\n\t                    if (typeof callback === \"function\") {\n\t                        callback(this.data[property]);\n\t                    }\n                    }\n                }\n                */\n                \n                \n            });\n        }\n    };\n\n    return UserInfoService;\n});\n","\ndefine('tpl!taoDelivery/tpl/fullscreen-modal-feedback', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"(\";\n  if (helper = helpers.launchButton) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.launchButton); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \")\";\n  return buffer;\n  }\n\nfunction program3(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n            <button class=\\\"btn-info small enter-full-screen\\\" type=\\\"button\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Enter full screen\", options) : helperMissing.call(depth0, \"__\", \"Enter full screen\", options)))\n    + \"</button>\\n            \";\n  return buffer;\n  }\n\nfunction program5(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n            <button class=\\\"btn-info small close-full-screen-prompt\\\" type=\\\"button\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Close this prompt\", options) : helperMissing.call(depth0, \"__\", \"Close this prompt\", options)))\n    + \"</button>\\n            \";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"modal-feedback modal full-screen-modal\\\">\\n    <div class=\\\"modal-body clearfix\\\">\\n        <p class=\\\"message\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"This test needs to be taken in full screen mode\", options) : helperMissing.call(depth0, \"__\", \"This test needs to be taken in full screen mode\", options)))\n    + \"\\n            \";\n  stack1 = helpers.unless.call(depth0, (depth0 && depth0.fsSupported), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n        </p>\\n        <div class=\\\"rgt\\\">\\n            \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.fsSupported), {hash:{},inverse:self.program(5, program5, data),fn:self.program(3, program3, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n        </div>\\n    </div>\\n</div>\";\n  return buffer;\n  });\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\n *\n */\n\n/**\n *\n * @author dieter <dieter@taotesting.com>\n */\ndefine('taoDelivery/controller/runtime/fullScreen',[\n    'jquery',\n    'i18n',\n    'ui/feedback',\n    'ui/modal',\n    'tpl!taoDelivery/tpl/fullscreen-modal-feedback'\n], function ($, __, feedback, modal, dialogTpl) {\n    'use strict';\n\n    var $dialog;\n    var $body;\n    var d = document;\n    var dElem = d.documentElement;\n\n    var fs = (function() {\n       var _fs = {\n                isSupported: (!!d.exitFullscreen ||\n                    !!d.msExitFullscreen ||\n                    !!d.mozCancelFullScreen ||\n                    !!d.webkitExitFullscreen),\n                requestFullscreen: (dElem.requestFullscreen ||\n                    dElem.msRequestFullscreen ||\n                    dElem.mozRequestFullScreen ||\n                    (function() {\n                        dElem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\n                    })),\n                fullscreenchange: (function() {\n                    var prefixes = ['', 'ms', 'moz', 'webkit'],\n                        i = prefixes.length;\n                    while(i--) {\n                        if('on' + prefixes[i] + 'fullscreenchange' in dElem) {\n                            return prefixes[i] + 'fullscreenchange';\n                        }\n                    }\n                    return 'myfullscreenchange';\n                }()),\n                fullScreen: function() {\n                    return ((document.fullscreenElement && document.fullscreenElement !== null) ||\n                        document.mozFullScreen ||\n                        document.webkitIsFullScreen ||\n                        (screen.availHeight || screen.height - 30) <= window.innerHeight);\n                }\n            };\n\n        _fs.changeInterval = null;\n\n        // on older browsers wait for a full screen change to happen\n        // and fire the change event manually\n        _fs.awaitFsChange = function() {\n            var event = document.createEvent('Event');\n            event.initEvent(_fs.fullscreenchange, true, true);\n            _fs.changeInterval = setInterval(function() {\n                if(!_fs.fullScreen()) {\n                    document.dispatchEvent(event);\n                }\n            }, 2000);\n        };\n        \n        if(!_fs.isSupported) {\n            _fs.awaitFsChange();\n        }\n\n        return _fs;\n    }());\n\n\n    /**\n     * React to user input on the prompt which is either\n     * key press or click on the button\n     *\n     * @param evt\n     */\n    var handleUserInput = function handleUserInput (evt) {\n\n        // full screen needs to be initiated by pressing\n        // F11 (Windows/Linux) or Ctrl+Cmd+F (Mac)\n        if(!fs.isSupported) {\n            $dialog.modal('close');\n            return;\n        }\n\n        // accept 'enter' as only valid key stroke\n        if(evt.type === 'keydown' && (evt.keyCode || evt.which) !== 13) {\n            return;\n        }\n\n        // in all other cases either 'enter' has been hit or the enter button has been clicked\n        fs.requestFullscreen.call(dElem);\n        dElem.className += ' fullscreen';\n        $dialog.modal('close');\n    };\n\n\n    /**\n     * Initialize full screen\n     */\n    var init = function init() {\n\n        $body = $(document.body);\n\n        // listen either to the native or the change event created in the observer above\n        document.addEventListener(fs.fullscreenchange, function() {\n            if(!fs.fullScreen()) {\n                dElem.className = dElem.className.replace(/\\bfullscreen\\b/, '');\n                $dialog.modal('open');\n            }\n        });\n\n        modal($body);\n        $dialog = $(dialogTpl({\n            fsSupported: fs.isSupported,\n            // while this is vague chances that any Mac browser gets here are very little\n            launchButton: navigator.platform.toLowerCase().indexOf('Mac') === 0 ? 'Ctrl+⌘+F' : 'F11'\n        }));\n\n        $dialog[0].querySelector('button').addEventListener('click', function(e) {\n            handleUserInput(e);\n        });\n\n        document.addEventListener('keydown', function(e) {\n            if(!fs.fullScreen()) {\n                handleUserInput(e);\n            }\n        });\n\n        $dialog.on('opened.modal', function() {\n            clearInterval(fs.changeInterval);\n        });\n\n        $dialog.on('closed.modal', function() {\n            fs.awaitFsChange();\n        });\n\n        $body.append($dialog);\n        \n        $dialog.modal({\n            width: 500,\n            disableClosing: true,\n            startClosed: true\n        });\n\n        // Note that when a page is on full screen already on load (after F5 normally)\n        // fullscreenElement and therefor fs.fullScreen() will report the wrong value!\n        if(false === ((screen.availHeight || screen.height - 30) <= window.innerHeight)) {\n            $dialog.modal('open');\n        }\n    };\n\n    /**\n     * @exports\n     */\n    return {\n        init: init\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoDelivery/controller/runtime/deliveryExecution',[\n    'jquery',\n    'module',\n    'iframeResizer',\n    'context',\n    'serviceApi/ServiceApi',\n    'serviceApi/StateStorage',\n    'serviceApi/UserInfoService',\n    'taoDelivery/controller/runtime/fullScreen',\n    'layout/loading-bar'\n], function($, module, iframeResizer, context, ServiceApi, StateStorage, UserInfoService, fullScreen, loadingBar){\n\n    'use strict';\n\n    var $frameContainer,\n        $frame,\n        $headerHeight,\n        $footerHeight,\n        serviceApi;\n\n    function resizeMainFrame() {\n        var height = $(window).outerHeight() - $headerHeight - $footerHeight;\n        $frameContainer.height(height);\n        $frame.height(height);\n    }\n\n    var config = module.config();\n\n    if(!!config.deliveryServerConfig.requireFullScreen){\n        fullScreen.init();\n    }\n\n    $frameContainer = $('#outer-delivery-iframe-container');\n    $frame = $frameContainer.find('iframe');\n    $headerHeight = $('body > .content-wrap > header').outerHeight() || 0;\n    $footerHeight = $('body > footer').outerHeight() || 0;\n\n    $(document).on('serviceforbidden', function() {\n        window.location = context.root_url + 'tao/Main/logout';\n    });\n\n    serviceApi = eval(config.serviceApi);\n\n    serviceApi.onFinish(function() {\n        $.ajax({\n            url : config.finishDeliveryExecution,\n            data : {\n                'deliveryExecution' : config.deliveryExecution\n            },\n            type : 'post',\n            dataType : 'json',\n            success : function(data) {\n                window.location = data.destination;\n            }\n        });\n    });\n\n    $(document)\n        .on('loading', function(e){\n            loadingBar.start();\n        })\n        .on('unloading', function(){\n            setTimeout(function(){\n                loadingBar.stop();\n            }, 300);\n        })\n        .on('shutdown-com', function(){\n            //use when we want to stop all exchange between frames\n            $(document).off('heightchange');\n            $frame.off('load.eventHeight')\n                   .off('load.cors');\n        });\n\n    serviceApi.loadInto($frame.get(0));\n\n    $(window).bind('resize', function() {\n        resizeMainFrame();\n    });\n\n    resizeMainFrame();\n});\n\n"]}