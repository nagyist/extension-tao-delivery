define("taoDelivery/controller/routes",[],function(){"use strict";return{Delivery:{actions:{editDelivery:"controller/delivery/editDelivery",excludeTesttaker:"controller/delivery/testtaker"}}}}),define("taoDelivery/controller/delivery/editDelivery",["jquery","helpers","ui/modal"],function($,helpers){"use strict";return{start:function(){$("#exclude-btn").click(function(){var delivery=$(this).data("delivery");$("#testtaker-form").load(helpers._url("excludeTesttaker","Delivery","taoDelivery",{uri:delivery}),function(){$("body").prepend($("#modal-container")),$("#testtaker-form").modal()})})}}}),define("taoDelivery/controller/delivery/testtaker",["jquery","i18n","helpers","module","layout/section","ui/feedback"],function($,__,helpers,module,section,feedback){
"use strict";function switchList(){var target,current=$(this).parent().attr("id");"excludedList"==current?target=$("#assignedList"):"assignedList"==current&&(target=$("#excludedList")),"undefined"!=typeof target&&(target.append(this),this.scrollIntoView())}var timeout,$search=$("#tt-filter"),$list=$("#assignedList"),liveSearch=function(){var pattern=$search.val();clearTimeout(timeout),timeout=setTimeout(function(){filterList(new RegExp(pattern),$list)},300)},filterList=function(regex,list){list.children().each(function(index,element){null===$(element).text().match(regex)?$(element).hide():$(element).show()})};return{start:function(){$("#save-tt").click(function(){
var excluded=[];$("#excludedList > li").each(function(index){excluded.push($(this).data("uri"))});var assemblyUri=$('input[name="assemblyUri"]').val();$.ajax({url:helpers._url("saveExcluded","Delivery","taoDelivery"),type:"POST",data:{uri:assemblyUri,excluded:JSON.stringify(excluded)},dataType:"json",success:function(response){response.saved&&(feedback().success(__("Selection saved successfully")),section.loadContentBlock(helpers._url("editDelivery","Delivery","taoDelivery"),{uri:assemblyUri}))}})}),$("#assignedList > li").click(switchList),$("#excludedList > li").click(switchList),$("#close-tt").click(function(){$("#testtaker-form").modal("close")}),$search.keyup(liveSearch).siblings(".ctrl").click(liveSearch);
}}}),define("serviceApi/ServiceApi",["jquery","urlParser","iframeResizer"],function($,UrlParser,iframeResizer){function ServiceApi(baseUrl,parameters,serviceCallId,stateStorage,userService){this.baseUrl=baseUrl,this.parameters=parameters,this.connected=!1,this.serviceCallId=serviceCallId,this.state=stateStorage,this.userService=userService,this.onFinishCallback,this.onKillCallback,this.onDisplayChangeCallback}return ServiceApi.SIG_SUCCESS=0,ServiceApi.SIG_ERROR=1,ServiceApi.prototype.loadInto=function(frame,connected){var self=this,$frame=$(frame),callUrl=this.getCallUrl(),isCORSAllowed=new UrlParser(callUrl).checkCORS();$frame.on("load",function(e){$(document).on("serviceready",function(){
self.connect(frame,function(){$(document).off("serviceready"),"function"==typeof connected&&connected()})}),isCORSAllowed===!0&&(frame.contentWindow.__knownParent__=!0)}),$frame.attr("src",callUrl)},ServiceApi.prototype.connect=function(frame,connected){this.connected===!1&&frame.contentWindow&&"function"==typeof frame.contentWindow.onServiceApiReady&&(frame.contentWindow.onServiceApiReady(this),this.connected=!0,"function"==typeof connected&&connected())},ServiceApi.prototype.getCallUrl=function(){var params=this.parameters||{};return params.serviceCallId=this.serviceCallId,this.baseUrl+"?"+$.param(params)},ServiceApi.prototype.getUserPropertyValues=function(property,callback){
this.userService.get(property,callback)},ServiceApi.prototype.getServiceCallId=function(){return this.serviceCallId},ServiceApi.prototype.getState=function(){return this.state.get()},ServiceApi.prototype.setState=function(state,callback){return this.state.set(state,callback)},ServiceApi.prototype.getParameter=function(identifier){return"undefined"!=typeof this.parameters[identifier]?this.parameters[identifier]:null},ServiceApi.prototype.onFinish=function(callback){this.onFinishCallback=callback},ServiceApi.prototype.onKill=function(callback){this.onKillCallback=callback},ServiceApi.prototype.kill=function(callback){"function"==typeof this.onKillCallback?this.onKillCallback(callback):callback(0);
},ServiceApi.prototype.finish=function(valueArray){"function"==typeof this.onFinishCallback&&this.onFinishCallback(valueArray)},ServiceApi}),define("serviceApi/StateStorage",["jquery"],function($){"use strict";function StateStorage(state,submitUrl){this.state=state,this.submitUrl=submitUrl}return StateStorage.prototype.get=function(callback){return"function"==typeof callback&&callback(this.state),this.state},StateStorage.prototype.set=function(state,callback){state===this.state?"function"==typeof callback&&callback():(this.state=state,$.ajax({url:this.submitUrl,data:{state:state},type:"post",dataType:"json",success:"function"==typeof callback?callback:null}));
},StateStorage}),define("serviceApi/UserInfoService",["jquery"],function($){function UserInfoService(requestUrl,data){this.data=data,this.requestUrl=requestUrl}return UserInfoService.prototype.get=function(property,callback){this.data.hasOwnProperty(property)?"function"==typeof callback&&callback(this.data[property]):$.ajax({url:this.requestUrl,data:{property:property},type:"post",dataType:"json",success:function(service,callback){return function(r){for(key in r.data)service.data[key]=r.data[key];"function"==typeof callback&&callback(service.data[property])}}(this,callback)})},UserInfoService}),define("tpl!taoDelivery/tpl/fullscreen-modal-feedback",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+="(",(helper=helpers.launchButton)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.launchButton,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+")"}function program3(depth0,data){var helper,options,buffer="";return buffer+='\n            <button class="btn-info small enter-full-screen" type="button">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Enter full screen",options):helperMissing.call(depth0,"__","Enter full screen",options)))+"</button>\n            ";
}function program5(depth0,data){var helper,options,buffer="";return buffer+='\n            <button class="btn-info small close-full-screen-prompt" type="button">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Close this prompt",options):helperMissing.call(depth0,"__","Close this prompt",options)))+"</button>\n            "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,self=this;return buffer+='<div class="modal-feedback modal full-screen-modal">\n    <div class="modal-body clearfix">\n        <p class="message">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"This test needs to be taken in full screen mode",options):helperMissing.call(depth0,"__","This test needs to be taken in full screen mode",options)))+"\n            ",stack1=helpers.unless.call(depth0,depth0&&depth0.fsSupported,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n        </p>\n        <div class="rgt">\n            ',stack1=helpers["if"].call(depth0,depth0&&depth0.fsSupported,{hash:{},inverse:self.program(5,program5,data),fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </div>\n    </div>\n</div>";
})}),define("taoDelivery/controller/runtime/fullScreen",["jquery","i18n","ui/feedback","ui/modal","tpl!taoDelivery/tpl/fullscreen-modal-feedback"],function($,__,feedback,modal,dialogTpl){"use strict";var $dialog,$body,d=document,dElem=d.documentElement,fs=function(){var _fs={isSupported:!!(d.exitFullscreen||d.msExitFullscreen||d.mozCancelFullScreen||d.webkitExitFullscreen),requestFullscreen:dElem.requestFullscreen||dElem.msRequestFullscreen||dElem.mozRequestFullScreen||function(){dElem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)},fullscreenchange:function(){for(var prefixes=["","ms","moz","webkit"],i=prefixes.length;i--;)if("on"+prefixes[i]+"fullscreenchange"in dElem)return prefixes[i]+"fullscreenchange";
return"myfullscreenchange"}(),fullScreen:function(){return document.fullscreenElement&&null!==document.fullscreenElement||document.mozFullScreen||document.webkitIsFullScreen||(screen.availHeight||screen.height-30)<=window.innerHeight}};return _fs.changeInterval=null,_fs.awaitFsChange=function(){var event=document.createEvent("Event");event.initEvent(_fs.fullscreenchange,!0,!0),_fs.changeInterval=setInterval(function(){_fs.fullScreen()||document.dispatchEvent(event)},2e3)},_fs.isSupported||_fs.awaitFsChange(),_fs}(),handleUserInput=function(evt){return fs.isSupported?void(("keydown"!==evt.type||13===(evt.keyCode||evt.which))&&(fs.requestFullscreen.call(dElem),
dElem.className+=" fullscreen",$dialog.modal("close"))):void $dialog.modal("close")},init=function(){$body=$(document.body),document.addEventListener(fs.fullscreenchange,function(){fs.fullScreen()||(dElem.className=dElem.className.replace(/\bfullscreen\b/,""),$dialog.modal("open"))}),modal($body),$dialog=$(dialogTpl({fsSupported:fs.isSupported,launchButton:0===navigator.platform.toLowerCase().indexOf("Mac")?"Ctrl+âŒ˜+F":"F11"})),$dialog[0].querySelector("button").addEventListener("click",function(e){handleUserInput(e)}),document.addEventListener("keydown",function(e){fs.fullScreen()||handleUserInput(e)}),$dialog.on("opened.modal",function(){clearInterval(fs.changeInterval);
}),$dialog.on("closed.modal",function(){fs.awaitFsChange()}),$body.append($dialog),$dialog.modal({width:500,disableClosing:!0,startClosed:!0}),!1==(screen.availHeight||screen.height-30)<=window.innerHeight&&$dialog.modal("open")};return{init:init}}),define("taoDelivery/controller/runtime/deliveryExecution",["jquery","module","iframeResizer","context","serviceApi/ServiceApi","serviceApi/StateStorage","serviceApi/UserInfoService","taoDelivery/controller/runtime/fullScreen","layout/loading-bar"],function($,module,iframeResizer,context,ServiceApi,StateStorage,UserInfoService,fullScreen,loadingBar){"use strict";function resizeMainFrame(){var height=$(window).outerHeight()-$headerHeight-$footerHeight;
$frameContainer.height(height),$frame.height(height)}var $frameContainer,$frame,$headerHeight,$footerHeight,serviceApi,config=module.config();config.deliveryServerConfig.requireFullScreen&&fullScreen.init(),$frameContainer=$("#outer-delivery-iframe-container"),$frame=$frameContainer.find("iframe"),$headerHeight=$("body > .content-wrap > header").outerHeight()||0,$footerHeight=$("body > footer").outerHeight()||0,$(document).on("serviceforbidden",function(){window.location=context.root_url+"tao/Main/logout"}),serviceApi=eval(config.serviceApi),serviceApi.onFinish(function(){$.ajax({url:config.finishDeliveryExecution,data:{deliveryExecution:config.deliveryExecution
},type:"post",dataType:"json",success:function(data){window.location=data.destination}})}),$(document).on("loading",function(e){loadingBar.start()}).on("unloading",function(){setTimeout(function(){loadingBar.stop()},300)}).on("shutdown-com",function(){$(document).off("heightchange"),$frame.off("load.eventHeight").off("load.cors")}),serviceApi.loadInto($frame.get(0)),$(window).bind("resize",function(){resizeMainFrame()}),resizeMainFrame()});
//# sourceMappingURL=controllers.min.js.map